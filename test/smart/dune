(executable
 (name test)
 (modules
  append
  fifo
  hTTP
  loopback
  lwt_backend
  ref
  store_backend
  test
  uid
  unix_backend
  pipe)
 (libraries
  alcotest
  alcotest-lwt
  astring
  bigstringaf
  bos
  carton
  carton-lwt
  capability
  cstruct
  digestif
  digestif.c
  domain-name
  fmt
  fmt.tty
  fpath
  git
  git.nss
  git.nss.git
  git.nss.hkt
  git.nss.pck
  git.nss.pkt-line
  git.nss.sigs
  git.nss.smart
  git.nss.state
  git.nss.unixiz
  git.nss.wire-proto-v2
  git-unix
  git_version
  logs
  logs.fmt
  lwt
  lwt.unix
  mimic
  mirage-crypto-rng
  mirage-crypto-rng.unix
  mirage-flow
  ptime
  ptime.clock.os
  result
  rresult
  unix
  uri
))

(executable
 (name test_edn)
 (modules test_edn)
 (libraries alcotest fmt ipaddr domain-name git.nss.git mimic uri))

(rule
 (alias runtest)
 (package git-unix)
 (enabled_if
  (= %{os_type} "Unix"))
 (deps
  (:test test.exe)
  pack-testzone-0.pack
  pack-testzone-0.idx
  pack-testzone-1.pack
  pack-testzone-1.idx
  GET
  POST)
 (action
  (run %{test} --color=always)))

(rule
 (alias runtest)
 (package git)
 (deps
  (:test test_edn.exe))
 (action
  (run %{test} --color=always)))
