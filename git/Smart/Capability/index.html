<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Capability (git.Smart.Capability)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">git</a> &#x00BB; <a href="../index.html">Smart</a> &#x00BB; Capability</nav><header class="odoc-preamble"><h1>Module <code><span>Smart.Capability</span></code></h1><p>Capabilities module.</p><p>When the client talks with the server, it needs to inform capabilities (what it can handle). This is the exhaustive list of capabilities on the current Smart protocol. Then, the server responds too with capabilities.</p><p>The common part between the client and the server of capabilities should diverge how we handle the Smart protocol. For example, if the client does not allow <code>`Shallow</code> objects, we permit to define shallow objects on the API of the fetch command but we don't use them to notice to the server.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span><span> = </span><span>[ </span></code><table><tr id="type-t.Multi_ack" class="anchored"><td class="def constructor"><a href="#type-t.Multi_ack" class="anchor"></a><code><span>| </span></code><code><span>`Multi_ack</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>The <code>`Multi-ack</code> capability allows the server to return <code>&quot;ACK obj-id continue&quot;</code> as soon as it finds a commit that it can use as a common base, between the client's wants and the client's have set.</p><p>By sending this early, the server can potentially head off the client from walking any further down that particular branch of the client's repository history. The client may still need to walk down other branches, sending have lines for those, until the server has a complete cut across the DAG, or the client has said <code>&quot;done&quot;</code>.</p><span class="comment-delim">*)</span></td></tr><tr id="type-t.Multi_ack_detailed" class="anchored"><td class="def constructor"><a href="#type-t.Multi_ack_detailed" class="anchor"></a><code><span>| </span></code><code><span>`Multi_ack_detailed</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>This is an extension of <code>`Multi_ack</code> that permits client to better understand ther server's in-memory state.</p><span class="comment-delim">*)</span></td></tr><tr id="type-t.No_done" class="anchored"><td class="def constructor"><a href="#type-t.No_done" class="anchor"></a><code><span>| </span></code><code><span>`No_done</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>This capability should only be used with the smart HTTP protocol. If <code>`Multi_ack_detailed</code> and <code>`No_done</code> are both present, then the sender is free to immediately send a pack following its first <code>&quot;ACK obj-id ready&quot;</code> message.</p><p>Without <code>`No_done</code> in the smart HTTP protocol, the server session would end and the client has to make another trip to send <code>&quot;done&quot;</code> before the server can send the pack. <code>`No_done</code> removes the last round and thus slightly reduces latency.</p><span class="comment-delim">*)</span></td></tr><tr id="type-t.Thin_pack" class="anchored"><td class="def constructor"><a href="#type-t.Thin_pack" class="anchor"></a><code><span>| </span></code><code><span>`Thin_pack</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>A thin pack is one with deltas which reference base objects not contained within the pack (but are known to exist at the receiving end). This can reduce the network traffic significantly, but it requires the receiving end to know how to &quot;thicken&quot; these packs by adding the missing bases to the pack.</p><p>The <code>`UploadPack</code> server advertises <code>`Thin_pack</code> when it can generate and send a thin pack. A client requests the <code>`Thin_pack</code> capability when it understands how to <code>&quot;thicken&quot;</code> it, notifying the server that it can receive such a pack. A client MUST NOT request the <code>`Thin_pack</code> capability if it cannot turn a thin pack into a self-contained pack.</p><p><code>`ReceivePack</code>, on the other hand, is assumed by default to be able to handle thin packs, but can ask the client not to use the feature by advertising the <code>`No_thin</code> capability. A client MUST NOT send a thin pack if the server advertises the <code>`No_thin</code> capability.</p><span class="comment-delim">*)</span></td></tr><tr id="type-t.Side_band" class="anchored"><td class="def constructor"><a href="#type-t.Side_band" class="anchor"></a><code><span>| </span></code><code><span>`Side_band</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>See <code>`Side_band_64k</code>.</p><span class="comment-delim">*)</span></td></tr><tr id="type-t.Side_band_64k" class="anchored"><td class="def constructor"><a href="#type-t.Side_band_64k" class="anchor"></a><code><span>| </span></code><code><span>`Side_band_64k</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>This capability means that server can send, and client understand multiplexed progress reports and error into interleaved with the packfile itself.</p><p>These two options are mutually exclusive. A modern client always favors <code>`Side_band_64k</code>.</p><p>Either mode indicates that the packfile data will be streamed broken up into packets of up to either 1000 bytes in the case of <code>`Side_band</code>, or 65520 bytes in the case of <code>`Side_band_64k</code>. Each packet is made up of a leading 4-byte <i>pkt-line</i> length of how much data is in the packet, followed by a 1-byte stream code, followed by the actual data.</p><p>Further, with <code>`Side_band</code> and its up to 1000-byte messages, it's actually 999 bytes of payload and 1 byte for the stream code. With <code>`Side_band_64k</code>, same deal, you have up to 65519 bytes of data and 1 byte for the stream code.</p><p>The client MUST send only maximum of one of <code>`Side_band</code> and <code>`Side_band_64k</code>. Server MUST diagnose it as an error if client requests both.</p><span class="comment-delim">*)</span></td></tr><tr id="type-t.Ofs_delta" class="anchored"><td class="def constructor"><a href="#type-t.Ofs_delta" class="anchor"></a><code><span>| </span></code><code><span>`Ofs_delta</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Server can send, and client understand PACKv2 with delta referring to its base by position in path rather than by an obj-id. That is, they can send/read OBJ_OFS_DETLA (aka type 6) in a packfile.</p><span class="comment-delim">*)</span></td></tr><tr id="type-t.Agent" class="anchored"><td class="def constructor"><a href="#type-t.Agent" class="anchor"></a><code><span>| </span></code><code><span>`Agent <span class="keyword">of</span> string</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>The server may optionnaly send a capability of the form <code>&quot;agent=X&quot;</code> to notify the client that the server is running version <code>&quot;X&quot;</code>. The client may optionnaly return its own agent string by responding with an <code>&quot;agent=Y&quot;</code> capability (but it MUST NOT do so if the server did not mention the agent capability). the <code>&quot;X&quot;</code> and <code>&quot;Y&quot;</code> strings may contain any printable ASCII characters except space (i.e. the byte range <code>32 &lt; x &lt; 127</code>), and are typically of the form <code>&quot;package/version&quot;</code> (e.g., <code>&quot;git/1.8.3.1&quot;</code>). The agent strings are purely informative for statistics and debugging purposes, and MUST NOT be used to programmatically assume the presence or absence of particular features.</p><span class="comment-delim">*)</span></td></tr><tr id="type-t.Shallow" class="anchored"><td class="def constructor"><a href="#type-t.Shallow" class="anchor"></a><code><span>| </span></code><code><span>`Shallow</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>This capability adds <code>&quot;deepen&quot;</code>, <code>&quot;shallow&quot;</code> and <code>&quot;unshallow&quot;</code> commands to the fetch-pack/upload-pack protocol so clients can request shallow clones.</p><span class="comment-delim">*)</span></td></tr><tr id="type-t.Deepen_since" class="anchored"><td class="def constructor"><a href="#type-t.Deepen_since" class="anchor"></a><code><span>| </span></code><code><span>`Deepen_since</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>This capability adds <code>&quot;deepen-since&quot;</code> command to fetch-pack/upload-pack protocol so the client can request shallow clones that are cut at a specific time, instead of depth. Internally it's equivalent of doing <code>&quot;git rev-list --max-age=&lt;timestamp&gt;&quot;</code> on the server side. <code>`Deepen_since</code> cannot be used with <code>`Deepen</code>.</p><span class="comment-delim">*)</span></td></tr><tr id="type-t.Deepen_not" class="anchored"><td class="def constructor"><a href="#type-t.Deepen_not" class="anchor"></a><code><span>| </span></code><code><span>`Deepen_not</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>This capability adds <code>`Deepen_not</code> command to fetch-pacj/upload-pack protocol so the client can request shallow clones that are cut at a specific revision, instead of depth. Internanlly it's equivalent of doing <code>&quot;git rev-list --not &lt;rev&gt;&quot;</code> on the server side. <code>`Deepen_not</code> cannot be used with <code>`Deepen</code>, but can be used with <code>`Deepen_since</code>.</p><span class="comment-delim">*)</span></td></tr><tr id="type-t.No_progress" class="anchored"><td class="def constructor"><a href="#type-t.No_progress" class="anchor"></a><code><span>| </span></code><code><span>`No_progress</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>The client was started with <code>&quot;git clone -q&quot;</code> or something, and does not want that side band 2. Basically the client just says <code>&quot;I do not wish to receive stream 2 on sideband, so do not send it to
        me, and if you did, I will drop it on the floor anyway&quot;</code>. However, the sideband channel 3 is still used for error responses.</p><span class="comment-delim">*)</span></td></tr><tr id="type-t.Include_tag" class="anchored"><td class="def constructor"><a href="#type-t.Include_tag" class="anchor"></a><code><span>| </span></code><code><span>`Include_tag</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>The <code>`Include_tag</code> capability is about sending annotated tags if we are sending objects they point to. If we pack an object to the client, and a tag object points exactly at that object, we pack the tag object too. In general this allows a client to get all new annotated tags when it fetches a branch, in a single network connection.</p><p>Clients MAY always send <code>`Include_tags</code>, hardcoding it into a request when the server advertises this capability. The decision for a client to request <code>`Include_tag</code> only has to do with the client's desires for tag <code>&quot;refs/tags/*&quot;</code> namespace.</p><p>Servers MUST pack the tags if their referrant is packed and the client has requested <code>`Include_tag</code>.</p><p>Clients MUST be prepared for the case where a server has ignored <code>`Include_tag</code> and has not actually sent tags in the pack. In such cases the client SHOULD issue a subsequent fetch to acquire the tags that <code>`Include_tag</code> would have otherwise given the client.</p><p>The server SHOULD send <code>`Include_tag</code>, if it supports it, regardless of whether or not there are tags available.</p><span class="comment-delim">*)</span></td></tr><tr id="type-t.Report_status" class="anchored"><td class="def constructor"><a href="#type-t.Report_status" class="anchor"></a><code><span>| </span></code><code><span>`Report_status</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>The <code>`ReceivePack</code> process can receive a <code>`Report_status</code> capability, which tells it that the client wants a report of what happened after a packfile upload and reference update. If the pushing client requests this capability, after unpacking and updating references the server will respond with whether the packfile unpacked successfully and if each reference was updated successfully. If any of those were not successful, it will send back an error message.</p><span class="comment-delim">*)</span></td></tr><tr id="type-t.Delete_refs" class="anchored"><td class="def constructor"><a href="#type-t.Delete_refs" class="anchor"></a><code><span>| </span></code><code><span>`Delete_refs</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>If the server sends back the <code>`Delete_refs</code> capability, it means that it is capable of accepting a zero-id value as the target value of a reference update. It is not sent back by the client, it simply informs the client that it can be sent zero-id values to delete references.</p><span class="comment-delim">*)</span></td></tr><tr id="type-t.Quiet" class="anchored"><td class="def constructor"><a href="#type-t.Quiet" class="anchor"></a><code><span>| </span></code><code><span>`Quiet</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>If the <code>`ReceivePack</code> server advertises the <code>`Quiet</code> capability, it is capable of silencing human-readable progress output which otherwise may be shown when processing the receiving pack. A send-pack client should respond with the <code>`Quiet</code> capability to suppress server-side progress reporting if the local progress reporting is also being suppressed (e.g., via <code>&quot;git push -q&quot;</code>, or if <code>stderr</code> does not go to a tty).</p><span class="comment-delim">*)</span></td></tr><tr id="type-t.Atomic" class="anchored"><td class="def constructor"><a href="#type-t.Atomic" class="anchor"></a><code><span>| </span></code><code><span>`Atomic</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>If the server sends the <code>`Atomic</code> capability it is capable of acceping atomic pushes. If the pushing client requests this capability, the server will update the refs in one atomic transaction. Either all refs are updated or none.</p><span class="comment-delim">*)</span></td></tr><tr id="type-t.Push_options" class="anchored"><td class="def constructor"><a href="#type-t.Push_options" class="anchor"></a><code><span>| </span></code><code><span>`Push_options</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>If the server sends the <code>`Push_options</code> capability it is able to accept push options after the update commands have been sent, but before the packfile is streamed. If the pushing client requests this capability, the server will pass the options to the pre- and post- receive hooks that process this push request.</p><span class="comment-delim">*)</span></td></tr><tr id="type-t.Allow_tip_sha1_in_want" class="anchored"><td class="def constructor"><a href="#type-t.Allow_tip_sha1_in_want" class="anchor"></a><code><span>| </span></code><code><span>`Allow_tip_sha1_in_want</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>If the upload-pack server advertises this capability, fetch-pack may send <code>&quot;want&quot;</code> lines with hashes that exists at the server but are not advertised by upload-pack.</p><span class="comment-delim">*)</span></td></tr><tr id="type-t.Allow_reachable_sha1_in_want" class="anchored"><td class="def constructor"><a href="#type-t.Allow_reachable_sha1_in_want" class="anchor"></a><code><span>| </span></code><code><span>`Allow_reachable_sha1_in_want</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>If the upload-pack server advertises this capability, fetch-pack may send <code>&quot;want&quot;</code> lines with hashes that exists at the server but are not advertised by upload-pack.</p><span class="comment-delim">*)</span></td></tr><tr id="type-t.Push_cert" class="anchored"><td class="def constructor"><a href="#type-t.Push_cert" class="anchor"></a><code><span>| </span></code><code><span>`Push_cert <span class="keyword">of</span> string</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>The receive-pack server that advertises this capability is willing to accept a signed push certificate, and asks the &lt;nonce&gt; to be included in the push certificate. A send-pack client MUST NOT send a push-cert packet unless the receive-pack server advertises this capability.</p><span class="comment-delim">*)</span></td></tr><tr id="type-t.Symref" class="anchored"><td class="def constructor"><a href="#type-t.Symref" class="anchor"></a><code><span>| </span></code><code><span>`Symref <span class="keyword">of</span> string * string</span></code></td></tr><tr id="type-t.Other" class="anchored"><td class="def constructor"><a href="#type-t.Other" class="anchor"></a><code><span>| </span></code><code><span>`Other <span class="keyword">of</span> string</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Unrecognized capability.</p><span class="comment-delim">*)</span></td></tr><tr id="type-t.Parameter" class="anchored"><td class="def constructor"><a href="#type-t.Parameter" class="anchor"></a><code><span>| </span></code><code><span>`Parameter <span class="keyword">of</span> string * string</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Unrecognized capability with a value.</p><span class="comment-delim">*)</span></td></tr></table><code><span> ]</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-to_string" class="anchored"><a href="#val-to_string" class="anchor"></a><code><span><span class="keyword">val</span> to_string : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p><code>to_string c</code> returns a string representaiton of the capability <code>c</code>.</p></div></div><div class="odoc-spec"><div class="spec exception" id="exception-Capability_expect_value" class="anchored"><a href="#exception-Capability_expect_value" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Capability_expect_value</span> <span class="keyword">of</span> string</span></code></div><div class="spec-doc"><p>Exception to inform than the capability expects a value.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-of_string" class="anchored"><a href="#val-of_string" class="anchor"></a><code><span><span class="keyword">val</span> of_string : <span>?value:string <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>of_capability s</code> tries to decode <code>s</code> to a capability. If the capability excepts a value, we raise <code>Capability_expect_value</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-pp" class="anchored"><a href="#val-pp" class="anchor"></a><code><span><span class="keyword">val</span> pp : <span><a href="#type-t">t</a> <span class="xref-unresolved">Fmt</span>.t</span></span></code></div><div class="spec-doc"><p>Pretty-printer of <a href="#type-t"><code>t</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-compare" class="anchored"><a href="#val-compare" class="anchor"></a><code><span><span class="keyword">val</span> compare : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>Comparison function of <a href="#type-t"><code>t</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-equal" class="anchored"><a href="#val-equal" class="anchor"></a><code><span><span class="keyword">val</span> equal : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Equal function of <a href="#type-t"><code>t</code></a>.</p></div></div></div></body></html>